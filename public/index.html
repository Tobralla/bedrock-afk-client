async function updateUI() {
    const res = await fetch('/status');
    const bots = await res.json();
    const list = document.getElementById('botList');
    let totalShards = 0;
    let html = '';

    bots.forEach(bot => {
        totalShards += parseInt(bot.shards);
        const isOnline = bot.status === 'Online';
        const safeEmail = bot.email.replace(/[@.]/g, '');

        html += `
        <div class="account-card ${isOnline ? 'online' : ''}">
            <div class="card-top">
                <div class="info">
                    <h3>${bot.username}</h3>
                    <small>${bot.email} â€¢ ${bot.status}</small><br>
                    <span class="shards-pill">${parseInt(bot.shards).toLocaleString()} Shards</span>
                    <button style="background:none; border:none; color:#ff9d00; cursor:pointer;" onclick="refreshShards('${bot.email}')">ðŸ”„ Refresh</button>
                </div>
                <div>
                    ${isOnline 
                        ? `<button class="btn-chat" onclick="toggleChat('${safeEmail}')">ðŸ’¬ Chat</button>
                           <button class="btn-dis" onclick="trigger('disconnect', '${bot.email}')">Disconnect</button>`
                        : `<button class="btn-con" onclick="trigger('connect', '${bot.email}')">Connect</button>`
                    }
                </div>
            </div>
            <div id="chat-${safeEmail}" class="chat-drawer" style="display:none; margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="msg-${bot.email}" placeholder="Type /afk or a message..." style="flex:1; background:#333; color:white; border:1px solid #444; padding:5px;">
                    <button class="btn-add" onclick="sendChat('${bot.email}')">Send</button>
                </div>
            </div>
        </div>`;
    });
    list.innerHTML = html;
    document.getElementById('totalShards').innerText = totalShards.toLocaleString();
}

async function sendChat(email) {
    const input = document.getElementById(`msg-${email}`);
    if (!input.value) return;
    await fetch(`/chat?email=${email}&message=${encodeURIComponent(input.value)}`);
    input.value = '';
}

function toggleChat(id) {
    const el = document.getElementById(`chat-${id}`);
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
}
